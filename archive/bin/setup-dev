#!/usr/bin/env bash
# Development setup script for the Music Archive App
# This script ensures all dependencies are properly installed

set -e

echo "ğŸµ Setting up Music Archive App development environment..."

# Check if we're in the right directory
if [ ! -f "Gemfile" ]; then
    echo "âŒ Error: Gemfile not found. Please run this script from the Rails app directory."
    exit 1
fi

echo "ğŸ“¦ Installing system dependencies..."
sudo apt update -qq
sudo apt install -y libpq-dev postgresql-client

echo "ğŸ’ Installing Ruby gems..."
bundle install

echo "ğŸ—„ï¸ Setting up Active Storage..."
bin/rails active_storage:install

echo "ğŸ” Setting up Pundit authorization..."
bin/rails pundit:install

echo "ğŸ“§ Setting up email functionality..."
# letter_opener gem is already in Gemfile

echo "âš¡ Setting up JavaScript and Turbo..."
bin/rails importmap:install
bin/importmap pin @hotwired/turbo-rails

echo "ğŸ“Š Running database migrations..."
bin/rails db:migrate

echo "ğŸŒ± Seeding database with initial data..."
bin/rails db:seed

echo "ğŸ§ª Running tests to verify setup..."
bin/rails test:prepare

echo "âœ… Development environment setup complete!"
echo ""
echo "ğŸµ Music Archive App is ready!"
echo ""
echo "ğŸ” Admin Access:"
echo "   Email: admin@musicarchive.com"
echo "   Password: admin123"
echo ""
echo "ğŸš€ You can now start the server with:"
echo "   bin/rails server"
echo ""
echo "ğŸ”§ Or use Docker Compose:"
echo "   docker-compose up"
echo ""
echo "ğŸ“š Useful commands:"
echo "   bin/rails console          # Rails console"
echo "   bin/rails routes           # View routes"
echo "   bin/rails db:reset         # Reset database"
echo "   bin/rails test             # Run tests"
echo ""
echo "ğŸ“§ Email Testing:"
echo "   When creating users, emails will open in browser automatically" 